load("~/GitHub/edumer-ola2/input/data/original/db_proc_students.RData")
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr)
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr, sjmisc)
frq(db_students$p2_1)
merit <- db_students %>% select(p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8)
View(db_students)
merit <- db_students %>% select(p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8)
frq(db_students$p8)
merit <- db_students %>% select(p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2)
View(merit)
percep_esfuerzo = round(prop.table(table(categorias=merit$p2_1)),2)
percep_esfuerzo = as.data.frame(percep_esfuerzo)
percep_esfuerzo = round(prop.table(table(categorias=merit$p2_1)),2)
percep_esfuerzo = as.data.frame(percep_esfuerzo)
percep_esfuerzo$categorias <- factor(percep_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_percep_esfuerzo <- ggplot(percep_esfuerzo,aes(x=2,y=-Freq, fill=categorias))+
geom_bar(stat = "identity",
color="white")+
geom_text(aes(label = scales::percent(Freq)),
position=position_stack(vjust=0.5),color="black",size=4.5)+
coord_polar(theta = "y")+
scale_fill_brewer(palette = "Blues")+
theme_void()+
theme(legend.title = element_blank(),
plot.title = element_text(size=12, face="bold", hjust=0.5))+
xlim(0.5,2.5)+
labs(title="Estudiantes")
plot_percep_esfuerzo
pt = round(prop.table(table(categorias=merit$p2_2)),2)
pt = as.data.frame(pt)
pt$categorias <- factor(pt$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_pt <- ggplot(pt,aes(x=2,y=-Freq, fill=categorias))+
geom_bar(stat = "identity",
color="white")+
geom_text(aes(label = scales::percent(Freq)),
position=position_stack(vjust=0.5),color="black",size=4.5)+
coord_polar(theta = "y")+
scale_fill_brewer(palette = "Blues")+
theme_void()+
theme(legend.title = element_blank(),
plot.title = element_text(size=12, face="bold", hjust=0.5))+
xlim(0.5,2.5)+
labs(title="Estudiantes")
pref2 <- merit %>%
group_by(p3) %>%
summarise(count = n(), .groups = 'drop') %>%
mutate(pct = count / sum(count) * 100)
ggplot(pref2, aes(x=pref2, y= pct)) +
geom_bar(stat= "identity", fill = "#9ecae1")+
labs(x = "Preferencia de mérito en la escuela",
y = "Frecuencia" )   +
scale_x_continuous(breaks = c(0, 5, 10), labels = c("Esfuerzo", "Ambos", "Talento")) +
scale_y_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 100)) +
theme_classic() +
ggtitle("Figura 1.43: Preferencia respecto al criterio individual de mérito más importante\npara obtener buenas notas") +
theme(plot.title = element_text(size = 12,
face = "italic",
color = "black", hjust = 0.5),
plot.margin = margin(t = 20, r = 20, b = 20, l = 20)) +
geom_text(aes(label = paste0(round(pct, 1), "%")),
stat = "identity",
vjust = -0.5,
color = "black",
position = position_stack(0.5),
size = 4)
View(pref2)
ggplot(pref2, aes(x=p3, y= pct)) +
geom_bar(stat= "identity", fill = "#9ecae1")+
labs(x = "Preferencia de mérito en la escuela",
y = "Frecuencia" )   +
scale_x_continuous(breaks = c(0, 5, 10), labels = c("Esfuerzo", "Ambos", "Talento")) +
scale_y_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 100)) +
theme_classic() +
ggtitle("Figura 1.43: Preferencia respecto al criterio individual de mérito más importante\npara obtener buenas notas") +
theme(plot.title = element_text(size = 12,
face = "italic",
color = "black", hjust = 0.5),
plot.margin = margin(t = 20, r = 20, b = 20, l = 20)) +
geom_text(aes(label = paste0(round(pct, 1), "%")),
stat = "identity",
vjust = -0.5,
color = "black",
position = position_stack(0.5),
size = 4)
menos_nota <-merit %>% filter(p5==1) %>%
ggplot() +
geom_density(aes(x=p4), color = "#9ecae1", alpha = 0.8, linewidth = 0.7)  +
geom_density(aes(x=p6), color = "#3182bd", alpha = 0.8, linewidth = 0.7)+
labs(x = "Nota",
y = "Frecuencia" )  +
scale_y_percent() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_x_continuous(breaks = 1:7) +
expand_limits(x = c(1, 7))+
theme_classic() +
ggtitle("Mis promedio fue\n menos de lo que merezco") +
theme(plot.title = element_text(size = 9,
face = "bold",
color = "black", hjust = 0.5),
plot.margin = margin(t = 20, r = 20, b = 20, l = 20))
mas_nota <- proc_datos %>% filter(p5==3) %>%
ggplot() +
geom_density(aes(x=p4), color = "#9ecae1", alpha = 0.8, linewidth = 0.7)  +
geom_density(aes(x=p6), color = "#3182bd", alpha = 0.8, linewidth = 0.7)+
labs(x = "Nota",
y = "Frecuencia" )  +
scale_y_percent() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_x_continuous(breaks = 1:7) +
expand_limits(x = c(1, 7))+
theme_classic() +
ggtitle("Mi promedio fue\n más de lo que merezco") +
theme(plot.title = element_text(size = 9,
face = "bold",
color = "black", hjust = 0.5),
plot.margin = margin(t = 20, r = 20, b = 20, l = 20))
mas_nota <- merit %>% filter(p5==3) %>%
ggplot() +
geom_density(aes(x=p4), color = "#9ecae1", alpha = 0.8, linewidth = 0.7)  +
geom_density(aes(x=p6), color = "#3182bd", alpha = 0.8, linewidth = 0.7)+
labs(x = "Nota",
y = "Frecuencia" )  +
scale_y_percent() +
scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
scale_x_continuous(breaks = 1:7) +
expand_limits(x = c(1, 7))+
theme_classic() +
ggtitle("Mi promedio fue\n más de lo que merezco") +
theme(plot.title = element_text(size = 9,
face = "bold",
color = "black", hjust = 0.5),
plot.margin = margin(t = 20, r = 20, b = 20, l = 20))
# Leyenda personalizada
legend_plot <- ggplot(data.frame(x = c("Promedio obtenido", "Promedio que cree merecer"),
y = c(1, 1))) +
geom_point(aes(x = x, y = y, color = x), size = 5) +
scale_color_manual(values = c("#9ecae1", "#3182bd")) +
guides(color = guide_legend(title = NULL)) +
theme_void() +
theme(legend.position = "bottom")
legend <- cowplot::get_legend(legend_plot)
# Combinar los gráficos y la leyenda
combined_plot <- cowplot::plot_grid(menos_nota, mas_nota, nrow = 1, labels = NULL)
# Añadir el título y la leyenda al gráfico combinado
final_plot <- cowplot::plot_grid(
cowplot::plot_grid(NULL, annotate_figure(
combined_plot,
top = text_grob(
"Figura 1.54: Contraste entre la nota obtenida y la nota preferida\npor el estudiante",
size = 12,
face = "italic",
color = "black",
hjust = 0.5
),
bottom = NULL
), NULL, ncol = 1, rel_heights = c(0.1, 1, 0.1)),
legend, ncol = 1, rel_heights = c(1, 0.1)
)
final_plot
mn = round(prop.table(table(categorias=merit$p5)),2)
mn = as.data.frame(mn)
mn$categorias <- factor(mn$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_mn <- ggplot(mn,aes(x=2,y=-Freq, fill=categorias))+
geom_bar(stat = "identity",
color="white")+
geom_text(aes(label = scales::percent(Freq)),
position=position_stack(vjust=0.5),color="black",size=4.5)+
coord_polar(theta = "y")+
scale_fill_brewer(palette = "Blues")+
theme_void()+
theme(legend.title = element_blank(),
plot.title = element_text(size=12, face="bold", hjust=0.5))+
xlim(0.5,2.5)+
labs(title="Estudiantes")
load(".../edumer-ola2/input/data/original/db_proc_students.RData")
load(".../Github/edumer-ola2/input/data/original/db_proc_students.RData")
load("~/GitHub/edumer-ola2/input/data/original/db_proc_students_w02.RData")
load("C:/Users/LENOVO/Documents/GitHub/edumer-ola2/input/data/original/db_proc_students_w02.RData")
merit <- db_students_w02 %>% select(p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2)
frq(db_students_w02$p12_o2)
View(db_students_w02)
merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2)
pref2 <- merit %>%
group_by(p3_o2) %>%
summarise(count = n(), .groups = 'drop') %>%
mutate(pct = count / sum(count) * 100)
View(pref2)
View(db_students_w02)
des <- db_students_wo2 %>% select(p9_1_o2, p9_2_o2, p9_3_o2, p9_4_o2, p9_4_o2, p9_5_o2, p9_5_o2 )
des <- db_students_w02 %>% select(p9_1_o2, p9_2_o2, p9_3_o2, p9_4_o2, p9_4_o2, p9_5_o2, p9_5_o2 )
View(dfSummary(des))
print(summarytools::dfSummary(des), method="render")
des1 <- db_students %>% select(p9_1, p9_2, p9_3, p9_4, p9_5, p9_6 )
# Añadir el título y la leyenda al gráfico combinado
final_plot <- cowplot::plot_grid(
cowplot::plot_grid(NULL, annotate_figure(
combined_plot,
top = text_grob(
"Figura 1.54: Contraste entre la nota obtenida y la nota preferida\npor el estudiante",
size = 12,
face = "italic",
color = "black",
hjust = 0.5
),
bottom = NULL
), NULL, ncol = 1, rel_heights = c(0.1, 1, 0.1)),
legend, ncol = 1, rel_heights = c(1, 0.1)
)
final_plot
# Leyenda personalizada
legend_plot <- ggplot(data.frame(x = c("Promedio obtenido", "Promedio que cree merecer"),
y = c(1, 1))) +
geom_point(aes(x = x, y = y, color = x), size = 5) +
scale_color_manual(values = c("#9ecae1", "#3182bd")) +
guides(color = guide_legend(title = NULL)) +
theme_void() +
theme(legend.position = "bottom")
legend <- cowplot::get_legend(legend_plot)
# Combinar los gráficos y la leyenda
combined_plot <- cowplot::plot_grid(menos_nota, mas_nota, nrow = 1, labels = NULL)
# Añadir el título y la leyenda al gráfico combinado
final_plot <- cowplot::plot_grid(
cowplot::plot_grid(NULL, annotate_figure(
combined_plot,
top = text_grob(
"Figura 1.54: Contraste entre la nota obtenida y la nota preferida\npor el estudiante",
size = 12,
face = "italic",
color = "black",
hjust = 0.5
),
bottom = NULL
), NULL, ncol = 1, rel_heights = c(0.1, 1, 0.1)),
legend, ncol = 1, rel_heights = c(1, 0.1)
)
final_plot
frq(db_students$p8_1)
frq(db_students$p8_2)
frq(merit$p4_o2)
frq(merit$p7_o2)
frq(merit$p6_o2)
merit1 <- db_students %>% select(p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2)
dm1 = round(prop.table(table(categorias=merit1$p9_6)),2)
dm1 = as.data.frame(dm1)
W01<- load("input/data/original/db_proc_students.Rdta")
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled,
ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr)
W01<- load("input/data/original/db_proc_students.Rdta")
W01<- load("input/data/original/db_proc_students.Rdta")
W02<- load("input/data/original/db_proc_students_w02.Rdta")
load("input/data/original/db_proc_students.Rdta")
load("../input/data/original/db_proc_students.Rdta")
load("../input/data/original/db_proc_students.Rdta")
load("~/GitHub/reporte-colegios/input/data/original/db_proc_students.RData")
load("input/data/original/db_proc_students.RData")
load("input/data/original/db_proc_students.RData")
load("input/data/original/db_proc_students_w02.Rdta")
load("input/data/original/db_proc_students_w02.Rdta")
load("input/data/original/db_proc_students_w02.RDta")
load("input/data/original/db_proc_students_w02.RData")
W01<-db_students
W02<-db_students_w02
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p1_1_o2"]]
proc_datos <- W01 %>% set_na(., na = c(99, 88))
proc_datosW02 <- W02 %>% set_na(., na = c(99, 88))
for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p1_"), starts_with("p2_"), starts_with("p8_"), starts_with("p9_"), starts_with("p17_")))) {
proc_datos[[i]] <- sjlabelled::set_labels(
x = proc_datos[[i]],
labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")
)
}
for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p1_"), starts_with("p2_"), starts_with("p8_"), starts_with("p9_"), starts_with("p17_")))) {
proc_datosW02[[i]] <- sjlabelled::set_labels(
x = proc_datosW02[[i]],
labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")
)
}
# Crear la función
graficar_dona <- function(data, columna, titulo = "Estudiantes") {
# Calcular la tabla de frecuencias y convertir a dataframe
tabla_frecuencia <- round(prop.table(table(categorias = data[[columna]])), 2)
tabla_frecuencia <- as.data.frame(tabla_frecuencia)
# Renombrar las categorías
tabla_frecuencia$categorias <- factor(
tabla_frecuencia$categorias,
levels = c(1, 2, 3, 4),
labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")
)
# Crear el gráfico de dona
plot <- ggplot(tabla_frecuencia, aes(x = 2, y = -Freq, fill = categorias)) +
geom_bar(stat = "identity", color = "white") +
geom_text(aes(label = scales::percent(Freq)),
position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
coord_polar(theta = "y") +
scale_fill_brewer(palette = "Blues") +
theme_void() +
theme(legend.title = element_blank(),
plot.title = element_text(size = 12, face = "bold", hjust = 0.5)) +
xlim(0.5, 2.5) +
labs(title = titulo)
return(plot)
}
plots_list_w02 <- list()
columnas2 <- paste0("p1_", 1:10, "_o2")
# Iterar sobre las columnas y generar los gráficos
for (col in columnas2) {
plot <- graficar_dona(proc_datosW02, col, "Estudiantes")
plots_list_w02[[col]] <- plot  # Guardar el gráfico en la lista usando el nombre de la columna
}
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p1_1_o2"]]
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p1_2_o2"]]
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p1_3_o2"]]
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p1_4_o2"]]
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p1_5_o2"]]
plots_list_w02 <- list()
columnas2 <- paste0("p11_", 1:10, "_o2")
# Iterar sobre las columnas y generar los gráficos
for (col in columnas2) {
plot <- graficar_dona(proc_datosW02, col, "Estudiantes")
plots_list_w02[[col]] <- plot  # Guardar el gráfico en la lista usando el nombre de la columna
}
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p11_1_o2"]]
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p11_2_o2"]]
plots_list_w02 <- list()
columnas2 <- paste0("p12_", 1:10, "_o2")
# Iterar sobre las columnas y generar los gráficos
for (col in columnas2) {
plot <- graficar_dona(proc_datosW02, col, "Estudiantes")
plots_list_w02[[col]] <- plot  # Guardar el gráfico en la lista usando el nombre de la columna
}
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p12_o2"]]
columnas2 <- paste0("p12_", 0:10, "_o2")
# Mostrar el gráfico de ejemplo, por ejemplo para "p1_1"
plots_list_w02[["p12_o2"]]
plot2 <- graficar_dona(proc_datos, "p12_o2", "Estudiantes")
plot2
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled,
ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr,
sjmisc, ggalluvial, shadowtext)
load("input/data/original/edumer_students_long.RData")
load("input/data/original/edumer_students_long.RData")
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled,
ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr,
sjmisc, ggalluvial, shadowtext)
load("input/data/original/edumer_students_long.RData")
# codificamos los valores 99-88 como missing para todas las variables-----------
db_long <- edumer_students_long %>% set_na(., na = c(99, 88))
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p1_"),
starts_with("p2_"), starts_with("p8_"), starts_with("p9_"),
starts_with("p17_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Muy en db_longacuerdo", "db_longacuerdo", "De acuerdo", "Muy de acuerdo")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p10_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Nada importante", "Algo importante", "Importante",
"Muy importante")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p11_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Seguro no haré esto", "Tal vez haré esto",
"Probablemente haré esto", "Seguro haré esto")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p12_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Si", "No")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p13_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Nunca", "Una vez al año", "Una vez al mes", "Semanalmente",
"Todos los días")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p18_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre")
)
}
install.packages("ggshadowtext")
library(dplyr)
library(ggplot2)
library(ggalluvial)
library(ggshadowtext)
# Definición de la función
crear_grafico_alluvial <- function(data, variable, etiquetas, colores, titulo, fuente) {
# Definición de la función
crear_grafico_alluvial <- function(data, variable, etiquetas, colores, titulo, fuente) {
etiquetas <- c("Muy en desacuerdo", "En desacuerdo", "De acuerdo", "Muy de acuerdo")
colores <- c("#f1eef6ff", "#bdc9e1ff", "#74a9cfff", "#0570b0ff")
titulo <- "Figura: En esta escuela quienes se esfuerzan\nobtienen buenas notas"
grafico <- crear_grafico_alluvial(
data = db_long,         # Tu base de datos
variable = "p1_2",      # La variable de interés
etiquetas = etiquetas,  # Etiquetas de los niveles
colores = colores,      # Colores personalizados
titulo = titulo,        # Título del gráfico
fuente = fuente         # Pie de página
)
grafico
etiquetas.pe[[variable]] <- factor}
etiquetas <- c("Muy en desacuerdo", "En desacuerdo", "De acuerdo", "Muy de acuerdo")
colores <- c("#f1eef6ff", "#bdc9e1ff", "#74a9cfff", "#0570b0ff")
titulo <- "Figura: En esta escuela quienes se esfuerzan\nobtienen buenas notas"
fuente <- "Fuente: EDUMER"
grafico <- crear_grafico_alluvial(
data = db_long,         # Tu base de datos
variable = "p1_2",      # La variable de interés
etiquetas = etiquetas,  # Etiquetas de los niveles
colores = colores,      # Colores personalizados
titulo = titulo,        # Título del gráfico
fuente = fuente         # Pie de página
)
grafico
print(grafico)
