geom_text(aes(label = scales::percent(Freq)),
position=position_stack(vjust=0.5),color="black",size=4.5)+
coord_polar(theta = "y")+
scale_fill_brewer(palette = "Blues")+
theme_void()+
theme(legend.title = element_blank(),
plot.title = element_text(size=12, face="bold", hjust=0.5))+
xlim(0.5,2.5)+
labs(title="Estudiantes")
plot_ce
ce1 = round(prop.table(table(categorias=db_students$p8_1)),2)
ce1 = as.data.frame(ce1)
ce1$categorias <- factor(ce$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
ce1 = round(prop.table(table(categorias=db_students$p8_1)),2)
ce1 = as.data.frame(ce1)
ce1$categorias <- factor(ce1$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_ce1 <- ggplot(ce1,aes(x=2,y=-Freq, fill=categorias))+
geom_bar(stat = "identity",
color="white")+
geom_text(aes(label = scales::percent(Freq)),
position=position_stack(vjust=0.5),color="black",size=4.5)+
coord_polar(theta = "y")+
scale_fill_brewer(palette = "Blues")+
theme_void()+
theme(legend.title = element_blank(),
plot.title = element_text(size=12, face="bold", hjust=0.5))+
xlim(0.5,2.5)+
labs(title="Estudiantes")
plot_ce1
merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2) %>% na.omit()
merit1 <- db_students %>% select(p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2) %>% na.omit()
des <- db_students_w02 %>% select(p9_1_o2, p9_2_o2, p9_3_o2, p9_4_o2, p9_5_o2, p9_6_o2)%>% na.omit()
des1 <- db_students %>% select(p9_1, p9_2, p9_3, p9_4, p9_5, p9_6 )%>% na.omit()
ce1 = round(prop.table(table(categorias=db_students$p8_1)),2)
ce1 = round(prop.table(table(categorias=merit1$p8_1)),2)
ce1 = as.data.frame(ce1)
ce1$categorias <- factor(ce1$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_ce1 <- ggplot(ce1,aes(x=2,y=-Freq, fill=categorias))+
geom_bar(stat = "identity",
color="white")+
geom_text(aes(label = scales::percent(Freq)),
position=position_stack(vjust=0.5),color="black",size=4.5)+
coord_polar(theta = "y")+
scale_fill_brewer(palette = "Blues")+
theme_void()+
theme(legend.title = element_blank(),
plot.title = element_text(size=12, face="bold", hjust=0.5))+
xlim(0.5,2.5)+
labs(title="Estudiantes")
plot_ce1
frq(merit$p5_o2)
load(".../input/data/original/db_proc_students_w02.RData")
load(".../input/data/original/db_proc_students_w02.RData")
load("/.../input/data/original/db_proc_students_w02.RData")
datos <- load(".../input/data/original/db_proc_students_w02.RData")
load(".../input/data/original/db_proc_students_w02.RData")
load("../input/data/original/db_proc_students_w02.RData")
load("../edumer-ola2/input/data/original/db_proc_students_w02.RData")
load("../input/data/original/db_proc_students_w02.RData")
load("../input/data/original/db_proc_students_w02.RData")
load("../edumer-ola2/input/data/original/db_proc_students_w02.RData")
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr, sjmisc)
load("../edumer-ola2/input/data/original/db_proc_students_w02.RData")
load("C:/Users/LENOVO/Documents/GitHub/edumer-ola2/input/data/original/db_proc_students.RData")
merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2) %>% na.omit()
merit1 <- db_students %>% select(p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2) %>% na.omit()
des <- db_students_w02 %>% select(p9_1_o2, p9_2_o2, p9_3_o2, p9_4_o2, p9_5_o2, p9_6_o2)%>% na.omit()
des1 <- db_students %>% select(p9_1, p9_2, p9_3, p9_4, p9_5, p9_6 )%>% na.omit()
load("C:/Users/LENOVO/Documents/GitHub/edumer-ola2/input/data/original/db_proc_students.RData")
frq(merit$p5_o2)
frq(merit$p7_o2)
frq(merit$p3_o2)
frq(merit$p2_1_o2)
merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2)
load("../edumer-ola2/input/data/original/db_proc_students_w02.RData")
merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2)
frq(merit$p2_1_o2)
frq(merit$p5_o2)
load("C:/Users/LENOVO/Documents/GitHub/edumer-ola2/input/data/original/db_proc_students.RData")
merit1 <- db_students %>% select(p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2)
merit1 <- db_students %>% select(p1_3, p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2)
frq(merit1$p1_3)
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr, sjmisc)
load("../edumer-ola2/input/data/original/db_proc_students_w02.RData")
load("C:/Users/LENOVO/Documents/GitHub/edumer-ola2/input/data/original/db_proc_students.RData")
merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2)
#%>% na.omit()
merit1 <- db_students %>% select(p1_3, p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2)
#%>% na.omit()
des <- db_students_w02 %>% select(p9_1_o2, p9_2_o2, p9_3_o2, p9_4_o2, p9_5_o2, p9_6_o2)
des1 <- db_students %>% select(p9_1, p9_2, p9_3, p9_4, p9_5, p9_6)
pe = round(prop.table(table(categorias=merit$p2_1_o2)),2)
pe = as.data.frame(pe)
pe$categorias <- factor(pe$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_pe <- ggplot(pe,aes(x=2,y=-Freq, fill=categorias))+
geom_bar(stat = "identity",
color="white")+
geom_text(aes(label = scales::percent(Freq)),
position=position_stack(vjust=0.5),color="black",size=4.5)+
coord_polar(theta = "y")+
scale_fill_brewer(palette = "Blues")+
theme_void()+
theme(legend.title = element_blank(),
plot.title = element_text(size=12, face="bold", hjust=0.5))+
xlim(0.5,2.5)+
labs(title="Ola 2")
pe1 = round(prop.table(table(categorias=merit1$p2_1)),2)
pe1 = as.data.frame(pe1)
pe1$categorias <- factor(pe1$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_pe1 <- ggplot(pe1,aes(x=2,y=-Freq, fill=categorias))+
geom_bar(stat = "identity",
color="white")+
geom_text(aes(label = scales::percent(Freq)),
position=position_stack(vjust=0.5),color="black",size=4.5)+
coord_polar(theta = "y")+
scale_fill_brewer(palette = "Blues")+
theme_void()+
theme(legend.title = element_blank(),
plot.title = element_text(size=12, face="bold", hjust=0.5))+
xlim(0.5,2.5)+
labs(title="Ola 1")
# grafico esfuerzo en la sociedad
# Combinar los grÃ¡ficos
final_pe <- ggarrange(
plot_pe,
plot_pe1,
common.legend = TRUE,
ncol = 2,
legend = "bottom")
# Agregar una etiqueta global centrada
plot_final_pe <- annotate_figure(
final_pe,
top = text_grob(
"Figura 1: En esta escuela quienes se esfuerzan obtienen buenas notas",
size = 12,
face = "italic",
color = "black",
hjust = 0.5))
plot_final_pe
merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2) %>% na.omit()
load("../edumer-ola2/input/data/original/db_proc_students_w02.RData")
load("C:/Users/LENOVO/Documents/GitHub/edumer-ola2/input/data/original/db_proc_students.RData")
merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2)
load("../edumer-ola2/input/data/proc/edumer_students_long.RData")
View(edumer_students_long)
head()
head(edumer_students_long)
frq(edumer_students_long$p30)
db_long <- load("../edumer-ola2/input/data/proc/edumer_students_long.RData")
db_long <- load("../edumer-ola2/input/data/proc/edumer_students_long.RData")
load("../edumer-ola2/input/data/proc/edumer_students_long.RData")
load("../edumer-ola2/input/data/proc/edumer_students_long.RData")
frq(edumer_students_long$ola)
frq(edumer_students_long$p2_1)
#Codificamos los valores 99-88 como missing para todas las variables
db_long <- edumer_students_long %>% set_na(., na = c(99, 88))
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr, sjmisc)
load("../edumer-ola2/input/data/proc/edumer_students_long.RData")
#load("../edumer-ola2/input/data/original/db_proc_students_w02.RData")
#load("C:/Users/LENOVO/Documents/GitHub/edumer-ola2/input/data/original/db_proc_students.RData")
#merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2)
#merit1 <- db_students %>% select(p1_3, p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2)
#des <- db_students_w02 %>% select(p9_1_o2, p9_2_o2, p9_3_o2, p9_4_o2, p9_5_o2, p9_6_o2)
#des1 <- db_students %>% select(p9_1, p9_2, p9_3, p9_4, p9_5, p9_6)
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr, sjmisc)
load("../edumer-ola2/input/data/proc/edumer_students_long.RData")
#load("../edumer-ola2/input/data/original/db_proc_students_w02.RData")
#load("C:/Users/LENOVO/Documents/GitHub/edumer-ola2/input/data/original/db_proc_students.RData")
#merit <- db_students_w02 %>% select(p2_1_o2, p2_2_o2, p2_3_o2, p3_o2, p4_o2, p5_o2, p6_o2, p7_o2, p8_1_o2, p8_2_o2)
#merit1 <- db_students %>% select(p1_3, p2_1, p2_2, p2_3, p3, p4, p5, p6, p7, p8_1, p8_2)
#des <- db_students_w02 %>% select(p9_1_o2, p9_2_o2, p9_3_o2, p9_4_o2, p9_5_o2, p9_6_o2)
#des1 <- db_students %>% select(p9_1, p9_2, p9_3, p9_4, p9_5, p9_6)
#Codificamos los valores 99-88 como missing para todas las variables
db_long <- edumer_students_long %>% set_na(., na = c(99, 88))
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p1_"), starts_with("p2_"), starts_with("p8_"), starts_with("p9_"), starts_with("p17_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p10_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Nada importante", "Algo importante", "Importante", "Muy importante")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p11_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Seguro no harÃ© esto", "Tal vez harÃ© esto", "Probablemente harÃ© esto", "Seguro harÃ© esto")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p12_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Si", "No")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p13_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Nunca", "Una vez al aÃ±o", "Una vez al mes", "Semanalmente", "Todos los dÃ­as")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p18_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre")
)
}
frq(db_long$p2_1)
frq(db_long$ola)
pe <- edumer_students_long %>%
group_by(id_estudiante, ola) %>%
count(p2_1) %>%
group_by(ola) %>%
mutate(porcentaje=n/sum(n)) %>%
ungroup() %>%
na.omit()
View(pe)
# calcular frecuencias
pe <- db_long %>%
group_by(id_estudiante, ola) %>%
count(p2_1) %>%
group_by(ola) %>%
mutate(porcentaje=n/sum(n)) %>%
ungroup() %>%
na.omit()
# etiquetas
etiquetas.pe <- db_long %>%
group_by(ola, p2_1) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(ola) %>%
mutate(porcentaje = count / sum(count)) %>%
na.omit()
View(etiquetas.pe)
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("#aba8fa", "#c71558")) +
geom_shadowtext(data = etiquetas.pe,
aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 4,
color = rep('white'),
bg.colour='grey30')+
labs(y = "Porcentaje",
x = "Ola",
fill = "PercepciÃ³n esfuerzo en la escuela",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
# grafico alluvial
# calcular frecuencias
pe <- db_long %>%
group_by(id_estudiante, ola) %>%
count(p2_1) %>%
group_by(ola) %>%
mutate(porcentaje=n/sum(n)) %>%
ungroup() %>%
na.omit()
# etiquetas
etiquetas.pe <- db_long %>%
group_by(ola, p2_1) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(ola) %>%
mutate(porcentaje = count / sum(count)) %>%
na.omit()
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("#aba8fa", "#c71558")) +
geom_shadowtext(data = etiquetas.pe,
aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 4,
color = rep('white'),
bg.colour='grey30')+
labs(y = "Porcentaje",
x = "Ola",
fill = "PercepciÃ³n esfuerzo en la escuela",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
install.packages("ggalluvial")
library(ggalluvial)
# grafico alluvial
# calcular frecuencias
pe <- db_long %>%
group_by(id_estudiante, ola) %>%
count(p2_1) %>%
group_by(ola) %>%
mutate(porcentaje=n/sum(n)) %>%
ungroup() %>%
na.omit()
# etiquetas
etiquetas.pe <- db_long %>%
group_by(ola, p2_1) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(ola) %>%
mutate(porcentaje = count / sum(count)) %>%
na.omit()
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("#aba8fa", "#c71558")) +
geom_shadowtext(data = etiquetas.pe,
aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 4,
color = rep('white'),
bg.colour='grey30')+
labs(y = "Porcentaje",
x = "Ola",
fill = "PercepciÃ³n esfuerzo en la escuela",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("#aba8fa", "#c71558")) +
geom_shadowtext(data = etiquetas.pe,
aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 4,
color = rep('white'),
bg.colour='grey30')+
labs(y = "Porcentaje",
x = "Ola",
fill = "PercepciÃ³n esfuerzo en la escuela",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
# cargar paquetes
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr, sjmisc, ggalluvial)
# cargar base longitudinal
load("../edumer-ola2/input/data/proc/edumer_students_long.RData")
# codificamos los valores 99-88 como missing para todas las variables
db_long <- edumer_students_long %>% set_na(., na = c(99, 88))
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p1_"), starts_with("p2_"), starts_with("p8_"), starts_with("p9_"), starts_with("p17_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p10_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Nada importante", "Algo importante", "Importante", "Muy importante")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p11_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Seguro no harÃ© esto", "Tal vez harÃ© esto", "Probablemente harÃ© esto", "Seguro harÃ© esto")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p12_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Si", "No")
)
}
for (i in names(dplyr::select(db_long, tidyselect::starts_with("p13_")))) {
db_long[[i]] <- sjlabelled::set_labels(
x = db_long[[i]],
labels = c("Nunca", "Una vez al aÃ±o", "Una vez al mes", "Semanalmente", "Todos los dÃ­as")
)
}
# calcular frecuencias
pe <- db_long %>%
group_by(id_estudiante, ola) %>%
count(p2_1) %>%
group_by(ola) %>%
mutate(porcentaje=n/sum(n)) %>%
ungroup() %>%
na.omit()
# etiquetas
etiquetas.pe <- db_long %>%
group_by(ola, p2_1) %>%
summarise(count = n(), .groups = "drop") %>%
group_by(ola) %>%
mutate(porcentaje = count / sum(count)) %>%
na.omit()
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("#aba8fa", "#c71558")) +
geom_shadowtext(data = etiquetas.pe,
aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 4,
color = rep('white'),
bg.colour='grey30')+
labs(y = "Porcentaje",
x = "Ola",
fill = "PercepciÃ³n esfuerzo en la escuela",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("#aba8fa", "#c71558")) +
#geom_shadowtext(data = etiquetas.pe,
#      aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
#     position = position_stack(vjust = .5),
#    show.legend = FALSE,
#   size = 4,
#  color = rep('white'),
# bg.colour='grey30')+
labs(y = "Porcentaje",
x = "Ola",
fill = "PercepciÃ³n esfuerzo en la escuela",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
# scale_fill_manual(values = c("#aba8fa", "#c71558")) +
#geom_shadowtext(data = etiquetas.pe,
#      aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
#     position = position_stack(vjust = .5),
#    show.legend = FALSE,
#   size = 4,
#  color = rep('white'),
# bg.colour='grey30')+
labs(y = "Porcentaje",
x = "Ola",
fill = "PercepciÃ³n esfuerzo en la escuela",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
install.packages("shadowtext")
# cargar paquetes
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes, tidyr, stringr, sjmisc, ggalluvial, shadowtext)
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
# scale_fill_manual(values = c("#aba8fa", "#c71558")) +
geom_shadowtext(data = etiquetas.pe,
aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 4,
color = rep('white'),
bg.colour='grey30')+
labs(y = "Porcentaje",
x = "Ola",
fill = "Grado de acuerdo",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
View(pe)
# grafico
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent) +
# scale_fill_manual(values = c("#aba8fa", "#c71558")) +
geom_shadowtext(data = etiquetas.pe,
aes(label = ifelse(porcentaje > 0 , scales::percent(porcentaje, accuracy = .1),"")),
position = position_stack(vjust = .5),
show.legend = FALSE,
size = 4,
color = rep('white'),
bg.colour='grey30') +
labs(y = "Porcentaje",
x = "Ola",
fill = "Grado de acuerdo",
caption = "Fuente: EDUMER") +
theme(legend.position = "bottom")
pe %>%
ggplot(aes(x = ola, fill = p2_1, stratum = p2_1,
alluvium = id_estudiante, y = porcentaje)) +
ggalluvial::geom_flow(alpha = .4) +
ggalluvial::geom_stratum(linetype = 0) +
scale_y_continuous(labels = scales::percent)
db_long <- db_long %>% filter(!is.na(p2_1) & !is.na(ola))
